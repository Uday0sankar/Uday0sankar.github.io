<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Typing Test</title>
  <style>
    body { font-family: sans-serif; text-align: center; margin-top: 50px; }
    .joke { font-size: 24px; margin: 20px auto; padding: 20px; max-width: 600px; }
    .getJoke { padding: 10px 20px; font-size: 18px; cursor: pointer; }
  </style>
</head>
<body>
  <h1>Typing Test</h1>
  <p>Type the text as you see it below:</p>
  <div id="content" style="color:blue;" class="joke">Loading...</div>
  <button class="getJoke">reset</button>
  <input id="area" class="joke" style="color:red;" oninput="startTyping()" >

</input>


  <script>
    const jokeButton = document.querySelector('.getJoke');
    const jokeHolder = document.querySelector('.joke');

    async function fetchJoke() {
      const response = await fetch('https://icanhazdadjoke.com/', {
        headers: { 'Accept': 'application/json' }
      });
      const data = await response.json();
      return data.joke;
    }

    async function handleClick() {
      const joke = await fetchJoke(); 
      console.log('function :Fetched joke:', joke);
      console.log('joke length:', joke.length);

      //input field size setting

      if (!isNaN(joke.length) && joke.length > 0) {
        area.maxLength = joke.length;
        area.placeholder = `Max ${joke.length} characters`;
      } else {
        area.removeAttribute('maxlength');
        area.placeholder = "Type here...";
      }

      //jokeHolder.textContent = joke;
      jokeHolder.innerHTML = joke.split('').map(c => `<span>${c}</span>`).join('');

    }

    function startTyping() {
      if (document.getElementById('area').value=="" & document.getElementById('area').value.length==0 & document.getElementById('area').value) {
        console.log('Input field is empty, no typing started');
        
      }
      const startTime = Date.now();
      console.log('Typing started at:', startTime);
      console.log("content to type ", jokeHolder.textContent);
      aim=jokeHolder.textContent;
     
      content=document.getElementById('content').value;
      console.log('text content:', content);

      console.log('User started typing');
      let Tchar=document.getElementById('area').value;
      console.log('Length of text:', Tchar.length);
       
      console.log('Current text:', Tchar); 
      console.log('last entered character:', Tchar.slice(-1));
      console.log('index of last character:', Tchar.indexOf(Tchar.slice(-1)), 'last character:', Tchar.charAt(Tchar.length - 1));
      enteredCharindex = Tchar.indexOf(Tchar.slice(-1));
      console.log('enteredCharindex',enteredCharindex)
      //console.log('index of content:', content.indexOf(Tchar.slice(-1)));
      lastChar = Tchar.charAt(Tchar.length - 1);
      console.log('Last character lastChar :', lastChar);       
      console.log('aim:', aim);
      console.log('aim index of last character:', aim[enteredCharindex])
      if (aim[enteredCharindex] === lastChar) {
        console.log('Correct character entered');
        console.log("Correct :",jokeHolder.textContent[enteredCharindex], );
        jokeHolder.children[enteredCharindex].style.color = 'green';

      } else {
        console.log('Incorrect character entered');
        console.log("Incorrect :",jokeHolder.textContent[enteredCharindex], );
        jokeHolder.children[enteredCharindex].style.color = 'red';

      }
      for (let i = 0; i <Tchar.length; i++) {
        if (aim[i] === Tchar[i]) {
          jokeHolder.children[i].style.color = 'green';
        } else {
          jokeHolder.children[i].style.color = 'red';
        }
      }

    }

    jokeButton.addEventListener('click', handleClick);

    // Load an initial joke
    handleClick();
  </script>
</body>
</html>





{% comment %} <!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Typing Test - Monkeytype Style</title>
    <style>
        body {
            font-family: 'Courier New', monospace;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100vh;
            margin: 0;
            background: #1a1a1a;
            color: #fff;
        }
        #container {
            text-align: center;
        }
        #text-display {
            font-size: 24px;
            margin-bottom: 20px;
            user-select: none;
        }
        .correct { color: #00ff00; }
        .incorrect { color: #ff0000; }
        .current { background: rgba(255, 255, 255, 0.2); }
        #input-field {
            font-size: 24px;
            padding: 10px;
            width: 600px;
            background: #2a2a2a;
            border: none;
            color: #fff;
            outline: none;
            border-radius: 5px;
        }
        #stats {
            margin-top: 20px;
            font-size: 18px;
        }
        #reset-btn {
            padding: 10px 20px;
            font-size: 16px;
            margin-top: 20px;
            background: #4CAF50;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
        }
        #reset-btn:hover {
            background: #45a049;
        }
    </style>
</head>
<body>
    <div id="container">
        <div id="text-display"></div>
        <input type="text" id="input-field" autofocus>
        <div id="stats">
            <p>Time: <span id="timer">30</span>s</p>
            <p>WPM: <span id="wpm">0</span></p>
            <p>Accuracy: <span id="accuracy">0</span>%</p>
            <p>High Score: <span id="high-score">0</span> WPM</p>
        </div>
        <button id="reset-btn" onclick="resetTest()">Reset</button>
    </div>

    <script>
        const textDisplay = document.getElementById('text-display');
        const inputField = document.getElementById('input-field');
        const timerDisplay = document.getElementById('timer');
        const wpmDisplay = document.getElementById('wpm');
        const accuracyDisplay = document.getElementById('accuracy');
        const highScoreDisplay = document.getElementById('high-score');

        const sampleTexts = [
            "the quick brown fox jumps over the lazy dog",
            "a journey of a thousand miles begins with a single step",
            "to be or not to be that is the question",
            "all that glitters is not gold",
            "the early bird catches the worm"
        ];

        let currentText = '';
        let timeLeft = 30;
        let timer = null;
        let isTestRunning = false;
        let charIndex = 0;
        let correctChars = 0;
        let totalCharsTyped = 0;

        // Load high score
        let highScore = localStorage.getItem('typingHighScore') || 0;
        highScoreDisplay.textContent = highScore;

        function startTest() {
            if (!isTestRunning) {
                isTestRunning = true;
                currentText = sampleTexts[Math.floor(Math.random() * sampleTexts.length)];
                renderText();
                inputField.value = '';
                charIndex = 0;
                correctChars = 0;
                totalCharsTyped = 0;

                timer = setInterval(() => {
                    timeLeft--;
                    timerDisplay.textContent = timeLeft;
                    if (timeLeft <= 0) {
                        endTest();
                    }
                }, 1000);
            }
        }

        function renderText() {
            textDisplay.innerHTML = '';
            currentText.split('').forEach((char, index) => {
                const span = document.createElement('span');
                span.textContent = char;
                if (index < charIndex) {
                    span.classList.add(inputField.value[index] === char ? 'correct' : 'incorrect');
                } else if (index === charIndex) {
                    span.classList.add('current');
                }
                textDisplay.appendChild(span);
            });
        }

        function endTest() {
            clearInterval(timer);
            isTestRunning = false;
            inputField.disabled = true;

            // Calculate WPM (words per minute)
            const timeElapsed = 30 - timeLeft;
            const wpm = Math.round((correctChars / 5) / (timeElapsed / 60));
            wpmDisplay.textContent = wpm;

            // Calculate accuracy
            const accuracy = totalCharsTyped > 0 ? Math.round((correctChars / totalCharsTyped) * 100) : 0;
            accuracyDisplay.textContent = accuracy;

            // Update high score
            if (wpm > highScore) {
                highScore = wpm;
                highScoreDisplay.textContent = highScore;
                localStorage.setItem('typingHighScore', highScore);
            }
        }

        function resetTest() {
            clearInterval(timer);
            timeLeft = 30;
            timerDisplay.textContent = timeLeft;
            wpmDisplay.textContent = '0';
            accuracyDisplay.textContent = '0';
            inputField.value = '';
            textDisplay.innerHTML = '';
            inputField.disabled = false;
            isTestRunning = false;
            charIndex = 0;
        }

        inputField.addEventListener('input', (e) => {
            if (!isTestRunning) startTest();

            const typed = e.target.value;
            charIndex = typed.length;
            totalCharsTyped++;

            if (charIndex <= currentText.length) {
                if (currentText[charIndex - 1] === typed[charIndex - 1]) {
                    correctChars++;
                }
                renderText();
            }

            if (charIndex === currentText.length) {
                endTest();
            }
        });

        // Initial render
        resetTest();
    </script>
</body>
</html> {% endcomment %}